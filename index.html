<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FPV Quad Build Validator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      color: #e2e8f0;
      padding: 1rem;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 2rem 0;
      border-bottom: 2px solid #334155;
      margin-bottom: 2rem;
    }

    h1 {
      font-size: 2.5rem;
      background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: #94a3b8;
      font-size: 1rem;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    @media (min-width: 768px) {
      .main-grid {
        grid-template-columns: 400px 1fr;
      }
    }

    .card {
      background: rgba(30, 41, 59, 0.8);
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 1.5rem;
      backdrop-filter: blur(10px);
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: #06b6d4;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: #cbd5e1;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    input, select {
      width: 100%;
      padding: 0.75rem;
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 6px;
      color: #e2e8f0;
      font-size: 1rem;
      transition: all 0.2s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #06b6d4;
      box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
    }

    input[type="number"] {
      -moz-appearance: textfield;
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .input-group {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 0.5rem;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    input[type="checkbox"] {
      width: auto;
      cursor: pointer;
    }

    .viz-container {
      background: #0f172a;
      border-radius: 8px;
      padding: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 400px;
      position: relative;
    }

    #quadCanvas {
      max-width: 100%;
      height: auto;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .metric-box {
      background: #0f172a;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #334155;
      text-align: center;
    }

    .metric-label {
      font-size: 0.75rem;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .metric-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #06b6d4;
    }

    .metric-unit {
      font-size: 0.875rem;
      color: #64748b;
      margin-left: 0.25rem;
    }

    .alert {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: flex;
      align-items: start;
      gap: 0.75rem;
    }

    .alert-error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fca5a5;
    }

    .alert-warning {
      background: rgba(251, 146, 60, 0.1);
      border: 1px solid rgba(251, 146, 60, 0.3);
      color: #fdba74;
    }

    .alert-success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #86efac;
    }

    .alert-icon {
      font-size: 1.25rem;
      flex-shrink: 0;
    }

    .characteristics {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .characteristic-tag {
      background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 600;
      color: white;
      box-shadow: 0 2px 8px rgba(6, 182, 212, 0.3);
    }

    .section-divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, #334155, transparent);
      margin: 2rem 0;
    }

    .wizard-toggle {
      background: #334155;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      border: none;
      color: #e2e8f0;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
      margin-bottom: 1.5rem;
    }

    .wizard-toggle:hover {
      background: #475569;
    }

    .wizard-toggle.active {
      background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
      color: white;
    }

    .optional-section {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 8px;
      border: 1px dashed #334155;
    }

    .optional-label {
      font-size: 0.75rem;
      color: #64748b;
      margin-bottom: 0.5rem;
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>FPV Quad Build Validator</h1>
      <p class="subtitle">Check compatibility, estimate weight, and characterize flight behavior before you build</p>
    </header>

    <div class="main-grid">
      <!-- Input Panel -->
      <div>
        <button class="wizard-toggle" id="wizardToggle">
          üßô Enable Wizard Mode
        </button>

        <div class="card">
          <div class="card-title">‚öôÔ∏è Build Components</div>

          <div class="form-group">
            <label>Frame Size</label>
            <select id="frameSize">
              <option value="">Select frame size...</option>
              <option value="1">1" (Tiny Whoop)</option>
              <option value="2">2" (Whoop/Indoor)</option>
              <option value="2.5">2.5" (Small Whoop)</option>
              <option value="3">3" (Toothpick/Cinewhoop)</option>
              <option value="3.5">3.5" (Ultralight)</option>
              <option value="5">5" (Standard Freestyle)</option>
              <option value="6">6" (Hybrid)</option>
              <option value="7">7" (Long Range)</option>
              <option value="10">10" (Heavy Lift)</option>
            </select>
          </div>

          <div class="form-group">
            <label>Propeller Details (Optional)</label>
            <div class="input-group">
              <input type="number" id="propPitch" placeholder="Pitch (e.g., 4.3)" step="0.1" min="0">
              <input type="number" id="propBlades" placeholder="Blades" min="2" max="6">
            </div>
          </div>

          <div class="form-group">
            <label>Motor Size</label>
            <input type="text" id="motorSize" placeholder="e.g., 2207, 1404, 2306" pattern="[0-9]{4}">
            <small style="color: #64748b; font-size: 0.75rem; margin-top: 0.25rem; display: block;">
              Format: XXYY (e.g., 2207 = 22mm stator width, 7mm height)
            </small>
          </div>

          <div class="form-group">
            <label>Motor KV</label>
            <input type="number" id="motorKv" placeholder="e.g., 2400, 1750" step="50" min="500" max="50000">
          </div>

          <div class="form-group">
            <label>Battery</label>
            <select id="batterySize">
              <option value="">Select battery...</option>
              <option value="1">1S (3.7-4.2V)</option>
              <option value="2">2S (7.4-8.4V)</option>
              <option value="3">3S (11.1-12.6V)</option>
              <option value="4">4S (14.8-16.8V)</option>
              <option value="6">6S (22.2-25.2V)</option>
              <option value="8">8S (29.6-33.6V)</option>
            </select>
          </div>

          <div class="optional-section">
            <span class="optional-label">Optional Components</span>

            <div class="form-group">
              <label>Flight Controller / ESC</label>
              <input type="text" id="fcStack" placeholder="e.g., F7 AIO, 4-in-1 ESC">
            </div>

            <div class="form-group">
              <label>VTx System</label>
              <select id="vtxType">
                <option value="none">None</option>
                <option value="analog">Analog</option>
                <option value="dji">DJI (Air Unit / O3 / O4)</option>
                <option value="walksnail">Walksnail/Avatar</option>
                <option value="hdzero">HDZero</option>
              </select>
            </div>

            <div class="form-group">
              <label>GPS Module</label>
              <div class="checkbox-group">
                <input type="checkbox" id="hasGps">
                <label for="hasGps" style="margin: 0; text-transform: none;">Include GPS</label>
              </div>
            </div>

            <div class="form-group">
              <label>Dry Weight Override (grams)</label>
              <input type="number" id="weightOverride" placeholder="Leave empty for auto-estimate" min="0" step="5">
            </div>
          </div>
        </div>
      </div>

      <!-- Results Panel -->
      <div>
        <div class="card">
          <div class="card-title">üìä Build Analysis</div>

          <div class="metrics-grid">
            <div class="metric-box">
              <div class="metric-label">Estimated Weight</div>
              <div class="metric-value"><span id="estimatedWeight">‚Äî</span><span class="metric-unit">g</span></div>
            </div>
            <div class="metric-box">
              <div class="metric-label">Thrust:Weight</div>
              <div class="metric-value"><span id="thrustWeight">‚Äî</span><span class="metric-unit">:1</span></div>
            </div>
            <div class="metric-box">
              <div class="metric-label">Viability</div>
              <div class="metric-value" id="viabilityScore">‚Äî</div>
            </div>
            <div class="metric-box">
              <div class="metric-label">Class</div>
              <div class="metric-value" id="buildClass" style="font-size: 1rem;">‚Äî</div>
            </div>
          </div>

          <div id="alerts"></div>

          <div class="section-divider"></div>

          <div class="viz-container">
            <canvas id="quadCanvas" width="500" height="400"></canvas>
          </div>

          <div class="section-divider"></div>

          <div class="card-title">üéØ Flight Characteristics</div>
          <div class="characteristics" id="characteristics">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Application state
    let wizardMode = false;
    let buildData = {
      frameSize: null,
      propPitch: null,
      propBlades: null,
      motorSize: null,
      motorKv: null,
      batterySize: null,
      fcStack: '',
      vtxType: 'none',
      hasGps: false,
      weightOverride: null
    };

    // Component weight database (grams)
    const COMPONENT_WEIGHTS = {
      vtx: {
        none: 0,
        analog: 3,
        dji: 30,
        walksnail: 28,
        hdzero: 12
      },
      gps: 15,
      // Frame weights by size (estimated base weight)
      frame: {
        1: 8,
        2: 12,
        2.5: 18,
        3: 25,
        3.5: 40,
        5: 80,
        6: 120,
        7: 150,
        10: 300
      },
      // Motor weights by stator size (per motor)
      motorWeightPerVolume: 0.0015 // grams per mm¬≥
    };

    // Compatibility rules
    const COMPATIBILITY_RULES = {
      // frameSize -> recommended motor size ranges [minStatorVolume, maxStatorVolume]
      motorSizing: {
        1: { min: 50, max: 200, recommended: [60, 120] },
        2: { min: 80, max: 300, recommended: [100, 200] },
        2.5: { min: 100, max: 350, recommended: [150, 250] },
        3: { min: 250, max: 600, recommended: [300, 500] },
        3.5: { min: 600, max: 1200, recommended: [800, 1100] },
        5: { min: 1800, max: 3500, recommended: [2200, 2800] },
        6: { min: 2500, max: 4500, recommended: [3000, 4000] },
        7: { min: 3000, max: 6000, recommended: [4000, 5500] },
        10: { min: 5000, max: 12000, recommended: [7000, 10000] }
      },
      // frameSize -> recommended KV ranges by battery size
      kvRanges: {
        1: { 1: [18000, 35000], 2: [12000, 25000] },
        2: { 1: [15000, 30000], 2: [10000, 22000] },
        2.5: { 1: [12000, 25000], 2: [8000, 18000] },
        3: { 2: [6000, 12000], 3: [4000, 8000], 4: [3000, 6000] },
        3.5: { 3: [3500, 6000], 4: [2500, 5000] },
        5: { 4: [2200, 3500], 6: [1400, 2400] },
        6: { 4: [2000, 3000], 6: [1300, 2200] },
        7: { 6: [1000, 1800], 8: [800, 1400] },
        10: { 6: [800, 1500], 8: [600, 1200] }
      }
    };

    // Get elements
    const elements = {
      wizardToggle: document.getElementById('wizardToggle'),
      frameSize: document.getElementById('frameSize'),
      propPitch: document.getElementById('propPitch'),
      propBlades: document.getElementById('propBlades'),
      motorSize: document.getElementById('motorSize'),
      motorKv: document.getElementById('motorKv'),
      batterySize: document.getElementById('batterySize'),
      fcStack: document.getElementById('fcStack'),
      vtxType: document.getElementById('vtxType'),
      hasGps: document.getElementById('hasGps'),
      weightOverride: document.getElementById('weightOverride'),
      estimatedWeight: document.getElementById('estimatedWeight'),
      thrustWeight: document.getElementById('thrustWeight'),
      viabilityScore: document.getElementById('viabilityScore'),
      buildClass: document.getElementById('buildClass'),
      alerts: document.getElementById('alerts'),
      characteristics: document.getElementById('characteristics'),
      canvas: document.getElementById('quadCanvas')
    };

    // Event listeners
    elements.wizardToggle.addEventListener('click', toggleWizardMode);
    elements.frameSize.addEventListener('change', updateBuild);
    elements.propPitch.addEventListener('input', updateBuild);
    elements.propBlades.addEventListener('input', updateBuild);
    elements.motorSize.addEventListener('input', updateBuild);
    elements.motorKv.addEventListener('input', updateBuild);
    elements.batterySize.addEventListener('change', updateBuild);
    elements.fcStack.addEventListener('input', updateBuild);
    elements.vtxType.addEventListener('change', updateBuild);
    elements.hasGps.addEventListener('change', updateBuild);
    elements.weightOverride.addEventListener('input', updateBuild);

    function toggleWizardMode() {
      wizardMode = !wizardMode;
      elements.wizardToggle.classList.toggle('active');
      elements.wizardToggle.textContent = wizardMode ? 'üßô Wizard Mode Active' : 'üßô Enable Wizard Mode';
      updateBuild();
    }

    function updateBuild() {
      // Update build data from inputs
      buildData.frameSize = parseFloat(elements.frameSize.value) || null;
      buildData.propPitch = parseFloat(elements.propPitch.value) || null;
      buildData.propBlades = parseInt(elements.propBlades.value) || null;
      buildData.motorSize = elements.motorSize.value || null;
      buildData.motorKv = parseInt(elements.motorKv.value) || null;
      buildData.batterySize = parseInt(elements.batterySize.value) || null;
      buildData.fcStack = elements.fcStack.value || '';
      buildData.vtxType = elements.vtxType.value || 'none';
      buildData.hasGps = elements.hasGps.checked;
      buildData.weightOverride = parseInt(elements.weightOverride.value) || null;

      // Perform analysis
      const analysis = analyzeBuild(buildData);

      // Update UI
      displayResults(analysis);
      drawQuad(analysis);
    }

    function analyzeBuild(data) {
      const analysis = {
        isValid: true,
        warnings: [],
        errors: [],
        weight: 0,
        thrustToWeight: 0,
        viability: 0,
        class: '',
        characteristics: []
      };

      // Basic validation
      if (!data.frameSize) {
        analysis.errors.push('Please select a frame size');
        analysis.isValid = false;
        return analysis;
      }

      if (!data.motorSize) {
        analysis.warnings.push('Motor size not specified');
      }

      if (!data.batterySize) {
        analysis.warnings.push('Battery not specified');
      }

      // Parse motor size
      let motorStatorWidth = 0;
      let motorStatorHeight = 0;
      let motorVolume = 0;

      if (data.motorSize && data.motorSize.length === 4) {
        motorStatorWidth = parseInt(data.motorSize.substring(0, 2));
        motorStatorHeight = parseInt(data.motorSize.substring(2, 4));
        motorVolume = Math.PI * Math.pow(motorStatorWidth / 2, 2) * motorStatorHeight;
      }

      // Check motor sizing compatibility
      if (motorVolume > 0) {
        const sizeRules = COMPATIBILITY_RULES.motorSizing[data.frameSize];
        if (sizeRules) {
          if (motorVolume < sizeRules.min) {
            analysis.errors.push(`Motors too small for ${data.frameSize}" frame. Minimum stator volume: ${sizeRules.min}mm¬≥ (you have ${Math.round(motorVolume)}mm¬≥)`);
          } else if (motorVolume > sizeRules.max) {
            analysis.errors.push(`Motors too large for ${data.frameSize}" frame. Maximum stator volume: ${sizeRules.max}mm¬≥ (you have ${Math.round(motorVolume)}mm¬≥)`);
          } else if (motorVolume < sizeRules.recommended[0] || motorVolume > sizeRules.recommended[1]) {
            analysis.warnings.push(`Motors outside recommended range (${sizeRules.recommended[0]}-${sizeRules.recommended[1]}mm¬≥). Build may work but won't be optimal.`);
          }
        }
      }

      // Check KV compatibility
      if (data.motorKv && data.batterySize) {
        const kvRules = COMPATIBILITY_RULES.kvRanges[data.frameSize];
        if (kvRules && kvRules[data.batterySize]) {
          const [minKv, maxKv] = kvRules[data.batterySize];
          if (data.motorKv < minKv) {
            analysis.warnings.push(`KV is low for this combination. Recommended range: ${minKv}-${maxKv}KV. May feel sluggish.`);
          } else if (data.motorKv > maxKv) {
            analysis.warnings.push(`KV is high for this combination. Recommended range: ${minKv}-${maxKv}KV. Motors may overheat.`);
          }
        }
      }

      // Estimate weight
      let estimatedWeight = data.weightOverride || 0;

      if (!data.weightOverride) {
        // Frame
        estimatedWeight += COMPONENT_WEIGHTS.frame[data.frameSize] || 0;

        // Motors (4x)
        if (motorVolume > 0) {
          const motorWeight = motorVolume * COMPONENT_WEIGHTS.motorWeightPerVolume;
          estimatedWeight += motorWeight * 4;
        }

        // FC/ESC (estimated based on size)
        if (data.frameSize <= 3) {
          estimatedWeight += 8; // AIO board
        } else if (data.frameSize <= 5) {
          estimatedWeight += 25; // Standard stack
        } else {
          estimatedWeight += 40; // Large stack
        }

        // VTX
        estimatedWeight += COMPONENT_WEIGHTS.vtx[data.vtxType] || 0;

        // GPS
        if (data.hasGps) {
          estimatedWeight += COMPONENT_WEIGHTS.gps;
        }

        // Battery (estimated)
        const batteryWeights = { 1: 8, 2: 30, 3: 45, 4: 120, 6: 220, 8: 400 };
        estimatedWeight += batteryWeights[data.batterySize] || 0;

        // Props, wires, misc (5-15% overhead)
        estimatedWeight *= 1.1;
      }

      analysis.weight = Math.round(estimatedWeight);

      // Calculate thrust-to-weight (simplified estimation)
      if (motorVolume > 0 && data.motorKv && data.batterySize) {
        const voltage = data.batterySize * 3.7; // Simplified
        const thrustPerMotor = (motorVolume * 0.04) * Math.pow(data.frameSize / 5, 1.5) * ((data.motorKv * voltage) / 1000);
        const totalThrust = thrustPerMotor * 4;
        analysis.thrustToWeight = (totalThrust / analysis.weight).toFixed(1);
      }

      // Determine class
      if (data.frameSize <= 2.5) {
        analysis.class = 'Micro';
      } else if (data.frameSize <= 3.5) {
        analysis.class = 'Ultra-Light';
      } else if (data.frameSize <= 5) {
        analysis.class = 'Standard';
      } else if (data.frameSize <= 7) {
        analysis.class = 'Long Range';
      } else {
        analysis.class = 'Heavy Lift';
      }

      // Calculate viability score (0-100)
      let viabilityScore = 100;
      viabilityScore -= analysis.errors.length * 30;
      viabilityScore -= analysis.warnings.length * 10;
      analysis.viability = Math.max(0, viabilityScore);

      // Determine flight characteristics
      analysis.characteristics = determineCharacteristics(data, analysis);

      return analysis;
    }

    function determineCharacteristics(data, analysis) {
      const chars = [];

      // Power characteristics
      if (analysis.thrustToWeight >= 8) {
        chars.push('üöÄ Like a Rocket');
      } else if (analysis.thrustToWeight >= 5) {
        chars.push('‚ö° Punchy');
      } else if (analysis.thrustToWeight >= 3) {
        chars.push('‚úÖ Adequate Power');
      } else if (analysis.thrustToWeight > 0) {
        chars.push('ü•î Like a Potato');
      }

      // Weight characteristics
      if (analysis.weight < 100) {
        chars.push('ü™∂ Featherweight');
        chars.push('üí® Floaty');
      } else if (analysis.weight < 300) {
        chars.push('‚öñÔ∏è Balanced');
      } else if (analysis.weight < 700) {
        chars.push('üîí Locked In');
      } else {
        chars.push('ü™® Heavy');
        chars.push('üéØ Stable Platform');
      }

      // Frame size characteristics
      if (data.frameSize <= 2.5) {
        chars.push('üè† Indoor Friendly');
        chars.push('üå™Ô∏è Twitchy');
      } else if (data.frameSize >= 7) {
        chars.push('üõ´ Cruiser');
        chars.push('‚è±Ô∏è Long Flight Times');
      }

      // KV characteristics
      if (data.motorKv && data.batterySize) {
        const rpm = data.motorKv * (data.batterySize * 3.7);
        if (rpm > 60000) {
          chars.push('üîä Screamer');
        } else if (rpm < 25000) {
          chars.push('ü§´ Quiet');
        }
      }

      // VTX characteristics
      if (data.vtxType === 'dji' || data.vtxType === 'walksnail') {
        chars.push('üìπ Cinematic');
      }

      // GPS
      if (data.hasGps) {
        chars.push('üó∫Ô∏è GPS Enabled');
      }

      return chars;
    }

    function displayResults(analysis) {
      // Update metrics
      elements.estimatedWeight.textContent = analysis.weight || '‚Äî';
      elements.thrustWeight.textContent = analysis.thrustToWeight || '‚Äî';
      elements.buildClass.textContent = analysis.class || '‚Äî';

      // Viability score with color
      if (analysis.viability >= 80) {
        elements.viabilityScore.textContent = '‚úÖ ' + analysis.viability;
        elements.viabilityScore.style.color = '#86efac';
      } else if (analysis.viability >= 50) {
        elements.viabilityScore.textContent = '‚ö†Ô∏è ' + analysis.viability;
        elements.viabilityScore.style.color = '#fdba74';
      } else {
        elements.viabilityScore.textContent = '‚ùå ' + analysis.viability;
        elements.viabilityScore.style.color = '#fca5a5';
      }

      // Display alerts
      let alertsHTML = '';

      if (!buildData.frameSize) {
        alertsHTML += '<div class="alert alert-warning"><span class="alert-icon">‚ÑπÔ∏è</span><span>Select a frame size to begin analysis</span></div>';
      } else {
        analysis.errors.forEach(err => {
          alertsHTML += `<div class="alert alert-error"><span class="alert-icon">‚ùå</span><span>${err}</span></div>`;
        });

        analysis.warnings.forEach(warn => {
          alertsHTML += `<div class="alert alert-warning"><span class="alert-icon">‚ö†Ô∏è</span><span>${warn}</span></div>`;
        });

        if (analysis.errors.length === 0 && analysis.warnings.length === 0) {
          alertsHTML += '<div class="alert alert-success"><span class="alert-icon">‚úÖ</span><span>Build looks good! No compatibility issues detected.</span></div>';
        }
      }

      elements.alerts.innerHTML = alertsHTML;

      // Display characteristics
      elements.characteristics.innerHTML = analysis.characteristics
        .map(char => `<div class="characteristic-tag">${char}</div>`)
        .join('');
    }

    function drawQuad(analysis) {
      const canvas = elements.canvas;
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;

      // Clear canvas
      ctx.clearRect(0, 0, width, height);

      if (!buildData.frameSize) {
        ctx.fillStyle = '#64748b';
        ctx.font = '16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Select a frame size to see visualization', width / 2, height / 2);
        return;
      }

      const centerX = width / 2;
      const centerY = height / 2;

      // Scale based on frame size
      const scale = Math.min(width, height) / (buildData.frameSize * 2.5);
      const armLength = (buildData.frameSize / 2) * scale;

      // Draw frame
      ctx.strokeStyle = '#06b6d4';
      ctx.lineWidth = 3;
      ctx.beginPath();

      // Draw X-pattern arms
      const armAngle = Math.PI / 4;
      const arms = [
        { angle: armAngle, label: 'FL' },
        { angle: Math.PI - armAngle, label: 'FR' },
        { angle: Math.PI + armAngle, label: 'BR' },
        { angle: 2 * Math.PI - armAngle, label: 'BL' }
      ];

      arms.forEach(arm => {
        const x = centerX + Math.cos(arm.angle) * armLength;
        const y = centerY + Math.sin(arm.angle) * armLength;

        ctx.moveTo(centerX, centerY);
        ctx.lineTo(x, y);
      });
      ctx.stroke();

      // Draw motors
      ctx.fillStyle = '#3b82f6';
      arms.forEach(arm => {
        const x = centerX + Math.cos(arm.angle) * armLength;
        const y = centerY + Math.sin(arm.angle) * armLength;

        ctx.beginPath();
        ctx.arc(x, y, 12, 0, 2 * Math.PI);
        ctx.fill();

        // Motor labels
        ctx.fillStyle = '#e2e8f0';
        ctx.font = 'bold 10px monospace';
        ctx.textAlign = 'center';
        ctx.fillText(arm.label, x, y - 20);
        ctx.fillStyle = '#3b82f6';
      });

      // Draw center body
      ctx.fillStyle = '#1e293b';
      ctx.strokeStyle = '#06b6d4';
      ctx.lineWidth = 2;
      const bodySize = Math.max(30, armLength * 0.3);
      ctx.beginPath();
      ctx.rect(centerX - bodySize / 2, centerY - bodySize / 2, bodySize, bodySize);
      ctx.fill();
      ctx.stroke();

      // Draw thrust vectors
      if (analysis.thrustToWeight > 0) {
        ctx.strokeStyle = '#fbbf24';
        ctx.lineWidth = 2;
        ctx.fillStyle = '#fbbf24';

        const thrustLength = Math.min(80, analysis.thrustToWeight * 10);

        arms.forEach(arm => {
          const x = centerX + Math.cos(arm.angle) * armLength;
          const y = centerY + Math.sin(arm.angle) * armLength;

          // Upward thrust arrow
          ctx.beginPath();
          ctx.moveTo(x, y);
          ctx.lineTo(x, y - thrustLength);
          ctx.stroke();

          // Arrow head
          ctx.beginPath();
          ctx.moveTo(x, y - thrustLength);
          ctx.lineTo(x - 5, y - thrustLength + 10);
          ctx.lineTo(x + 5, y - thrustLength + 10);
          ctx.closePath();
          ctx.fill();
        });
      }

      // Draw weight vector (downward)
      if (analysis.weight > 0) {
        ctx.strokeStyle = '#ef4444';
        ctx.lineWidth = 3;
        ctx.fillStyle = '#ef4444';

        const weightLength = Math.min(60, analysis.weight / 10);

        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.lineTo(centerX, centerY + weightLength);
        ctx.stroke();

        // Arrow head
        ctx.beginPath();
        ctx.moveTo(centerX, centerY + weightLength);
        ctx.lineTo(centerX - 6, centerY + weightLength - 12);
        ctx.lineTo(centerX + 6, centerY + weightLength - 12);
        ctx.closePath();
        ctx.fill();
      }

      // Draw legend
      ctx.font = '12px sans-serif';
      ctx.textAlign = 'left';

      ctx.fillStyle = '#fbbf24';
      ctx.fillText('‚Üë Thrust', 20, height - 60);

      ctx.fillStyle = '#ef4444';
      ctx.fillText('‚Üì Weight', 20, height - 40);

      ctx.fillStyle = '#06b6d4';
      ctx.fillText(`Frame: ${buildData.frameSize}"`, 20, height - 20);
    }

    // Initialize
    updateBuild();
  </script>
</body>
</html>
